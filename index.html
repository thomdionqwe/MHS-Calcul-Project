<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="style.css"> <!-- Initialize style + Import Bulma / MathQuill -->
		
		<script src="node_modules\mathjs/lib/browser/math.js"></script> <!-- Initialize Math.js -->

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <!-- Initialize MathQuill -->
		<script src="node_modules/mathquill/build/mathquill.js"></script>

		<script src="src\latex-to-js.js"></script> <!-- Initialize latex-to-js -->

		<script src="node_modules\function-plot\dist\function-plot.js"></script> <!-- Initialize function-plot -->

		<script>const MQ = MathQuill.getInterface(2);</script>

		<title>MHS Project</title>

	</head>

	<body>
		<div class="content">
			<h1>A peculiar Function Plotter.</h1>
			<p>This function plotter hopefuly works! YIPPEE!</p>
			<button class="button is-primary" type="button" onclick="refresh()">Visualize</button>

			<div class="box">
				<h1>Formula</h1>
				<p><span id="answer">x</span></p>
				<p id="output"></p>
			</div>

			<div class="box" id="graphContainer">
				<h1>Function Visualization</h1>
				<span id="graph" class="graph"></span>
				<script>
					const graphContainer = document.getElementById("graphContainer");
					const graph = document.getElementById("graph");
					var h = 0.001;
					addEventListener("resize", updateDimensions);
					
					var answerSpan = document.getElementById('answer');
					var answerMathField = MQ.MathField(answerSpan, {
						handlers: {
							edit: function() {
								let func = answerMathField.latex(); // Get entered math in LaTeX format
								visualize(func) //VISUALIZE!
							}
						}
					});
					
					function updateDimensions() { //Called when the window is resized. Is also called when the window is openned
						functionPlot({
							target: graph,
							width: graphContainer.offsetWidth - 50,
							height: (graphContainer.offsetWidth - 50) * 0.5625,
							grid: true,
							data: [{
								fn: latex_to_js(answerMathField.latex()) //VERY USEFUL, THANK YOU!
							}]
						});
						console.log("updated dimensions")
					}
					
					function visualize(func) { //Takes LaTeX function and plots it to the graph
						console.log(func);
						console.log(latex_to_js(func));
						console.log(getTVI(func, 1));
						
						functionPlot({
							target: graph,
							width: graphContainer.offsetWidth - 50,
							height: (graphContainer.offsetWidth - 50) * 0.5625,
							grid: true,
							data: [{
								fn: latex_to_js(func) //VERY USEFUL, THANK YOU!
							}]
						});
					}
					
					function getTVI(func, xTarget) { //Returns 'Taux de Variation Instantan√©' formula. There's a better way to do this but took too much time to debug
						let y1 = math.evaluate(latex_to_js(func), {x: xTarget});
						let y2 = math.evaluate(latex_to_js(func), {x: xTarget + h});
						
						//let latexTVI = "\\frac{(" + func + "-" + h + ")-(" + func + ")}{" + h + "}"; // \frac{(fx-h)-(fx)}{h}
						return (y2 - y1) / h;
					}
					
					updateDimensions(); //Initialize graph
				</script>
			</div>

		</div>
	</body>
</html>